{
  "worker_name": "customer_order_360_analyzer",
  "description": "Provides a joined view of orders, customer master data, and 360-degree customer metrics.",
  "knowledge": "Use this worker to analyze order patterns alongside customer information and lifetime value metrics. The primary key is order_key.",
  "database_info": {
    "type": "postgres",
    "schema": "public"
  },
  "max_limits": {
    "max_rows": 2000,
    "max_filters": 5,
    "max_aggregations": 4,
    "max_group_by_columns": 4
  },
  "source": {
    "type": "MULTI_TABLE_JOIN",
    "config": {
      "tables": [
        { "name": "gold_fact_orders", "alias": "o" },
        { "name": "gold_dim_customer", "alias": "c" },
        { "name": "gold_customer_360_spine_v1", "alias": "s" }
      ],
      "joins": [
        {
          "type": "INNER",
          "left_table_alias": "o",
          "right_table_alias": "c",
          "on": "o.customer_key = c.customer_key"
        },
        {
          "type": "LEFT",
          "left_table_alias": "c",
          "right_table_alias": "s",
          "on": "c.email = s.customer_360_id"
        }
      ]
    }
  },
  "columns": [
    { "name": "o.order_key", "type": "text", "description": "Unique identifier for the order.", "is_nullable": false, "is_pii": false },
    { "name": "o.order_date_key", "type": "date", "description": "Date the order was placed.", "is_nullable": false, "is_pii": false },
    { "name": "o.total_amount", "type": "numeric", "description": "Total order amount.", "is_nullable": false, "is_pii": false },
    { "name": "o.line_items_count", "type": "integer", "description": "Number of items in the order.", "is_nullable": true, "is_pii": false },
    { "name": "o.order_status", "type": "text", "description": "Status of the order (e.g., PAID, PENDING, REFUNDED).", "is_nullable": true, "is_pii": false },

    { "name": "c.email", "type": "text", "description": "Customer email.", "is_nullable": true, "is_pii": true },
    { "name": "c.first_name", "type": "text", "description": "Customer first name.", "is_nullable": true, "is_pii": true },
    { "name": "c.last_name", "type": "text", "description": "Customer last name.", "is_nullable": true, "is_pii": true },
    { "name": "c.city", "type": "text", "description": "Customer city.", "is_nullable": true, "is_pii": false },
    { "name": "c.status", "type": "text", "description": "Customer lifecycle status (active, inactive, lead).", "is_nullable": true, "is_pii": false },

    { "name": "s.total_orders", "type": "integer", "description": "Total number of orders completed by the customer.", "is_nullable": true, "is_pii": false },
    { "name": "s.total_revenue", "type": "numeric", "description": "Lifetime revenue generated by the customer.", "is_nullable": true, "is_pii": false },
    { "name": "s.avg_order_value", "type": "numeric", "description": "Average value of all customer orders.", "is_nullable": true, "is_pii": false },
    { "name": "s.customer_lifetime_value", "type": "numeric", "description": "Predicted customer lifetime value.", "is_nullable": true, "is_pii": false }
  ],
  "filters": [
    { "column": "o.order_status", "operators": ["=", "IN"], "description": "Filter by order status (e.g., PAID, REFUNDED)." },
    { "column": "o.order_date_key", "operators": [">=", "<="], "description": "Filter by an order date range." },
    { "column": "c.city", "operators": ["=", "IN"], "description": "Filter customers by city." },
    { "column": "s.total_orders", "operators": [">", "<="], "description": "Filter customers based on total orders." }
  ],
  "aggregations": [
    { "function": "SUM", "applicable_columns": ["o.total_amount"], "alias_template": "total_sales" },
    { "function": "AVG", "applicable_columns": ["o.total_amount"], "alias_template": "average_order_amount" },
    { "function": "COUNT", "applicable_columns": ["o.order_key"], "alias_template": "number_of_orders" },
    { "function": "SUM", "applicable_columns": ["s.customer_lifetime_value"], "alias_template": "total_customer_ltv" }
  ],
  "group_by_options": [
    "c.city",
    "c.status",
    "o.order_status",
    "o.order_date_key"
  ]
}
